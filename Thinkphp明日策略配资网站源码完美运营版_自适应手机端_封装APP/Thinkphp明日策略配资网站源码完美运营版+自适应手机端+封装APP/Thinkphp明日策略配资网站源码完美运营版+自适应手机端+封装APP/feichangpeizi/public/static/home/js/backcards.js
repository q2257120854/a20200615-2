
var arr = new  Array();
arr[0 ]="东城,西城,崇文,宣武,朝阳,丰台,石景山,海淀,门头沟,房山,通州,顺义,昌平,大兴,平谷,怀柔,密云,延庆"
arr[1 ]="黄浦,卢湾,徐汇,长宁,静安,普陀,闸北,虹口,杨浦,闵行,宝山,嘉定,浦东,金山,松江,青浦,南汇,奉贤,崇明"
arr[2 ]="和平,东丽,河东,西青,河西,津南,南开,北辰,河北,武清,红挢,塘沽,汉沽,大港,宁河,静海,宝坻,蓟县"
arr[3 ]="万州,涪陵,渝中,大渡口,江北,沙坪坝,九龙坡,南岸,北碚,万盛,双挢,渝北,巴南,黔江,长寿,綦江,潼南,铜梁,大足,荣昌,壁山,梁平,城口,丰都,垫江,武隆,忠县,开县,云阳,奉节,巫山,巫溪,石柱,秀山,酉阳,彭水,江津,合川,永川,南川"
arr[4 ]="石家庄,邯郸,邢台,保定,张家口,承德,廊坊,唐山,秦皇岛,沧州,衡水"
arr[5 ]="太原,大同,阳泉,长治,晋城,朔州,吕梁,忻州,晋中,临汾,运城"
arr[6 ]="呼和浩特,包头,乌海,赤峰,呼伦贝尔盟,阿拉善盟,哲里木盟,兴安盟,乌兰察布盟,锡林郭勒盟,巴彦淖尔盟,伊克昭盟"
arr[7 ]="沈阳,大连,鞍山,抚顺,本溪,丹东,锦州,营口,阜新,辽阳,盘锦,铁岭,朝阳,葫芦岛"
arr[8 ]="长春,吉林,四平,辽源,通化,白山,松原,白城,延边"
arr[9 ]="哈尔滨,齐齐哈尔,牡丹江,佳木斯,大庆,绥化,鹤岗,鸡西,黑河,双鸭山,伊春,七台河,大兴安岭"
arr[10 ]="南京,镇江,苏州,南通,扬州,盐城,徐州,连云港,常州,无锡,宿迁,泰州,淮安"
arr[11 ]="杭州,宁波,温州,嘉兴,湖州,绍兴,金华,衢州,舟山,台州,丽水"
arr[12 ]="合肥,芜湖,蚌埠,马鞍山,淮北,铜陵,安庆,黄山,滁州,宿州,池州,淮南,巢湖,阜阳,六安,宣城,亳州"
arr[13 ]="福州,厦门,莆田,三明,泉州,漳州,南平,龙岩,宁德"
arr[14 ]="南昌市,景德镇,九江,鹰潭,萍乡,新馀,赣州,吉安,宜春,抚州,上饶"
arr[15 ]="济南,青岛,淄博,枣庄,东营,烟台,潍坊,济宁,泰安,威海,日照,莱芜,临沂,德州,聊城,滨州,菏泽"
arr[16 ]="郑州,开封,洛阳,平顶山,安阳,鹤壁,新乡,焦作,濮阳,许昌,漯河,三门峡,南阳,商丘,信阳,周口,驻马店,济源"
arr[17 ]="武汉,宜昌,荆州,襄樊,黄石,荆门,黄冈,十堰,恩施,潜江,天门,仙桃,随州,咸宁,孝感,鄂州"
arr[18 ]="长沙,常德,株洲,湘潭,衡阳,岳阳,邵阳,益阳,娄底,怀化,郴州,永州,湘西,张家界"
arr[19 ]="广州,深圳,珠海,汕头,东莞,中山,佛山,韶关,江门,湛江,茂名,肇庆,惠州,梅州,汕尾,河源,阳江,清远,潮州,揭阳,云浮"
arr[20 ]="南宁,柳州,桂林,梧州,北海,防城港,钦州,贵港,玉林,南宁地区,柳州地区,贺州,百色,河池"
arr[21 ]="海口,三亚"
arr[22 ]="成都,绵阳,德阳,自贡,攀枝花,广元,内江,乐山,南充,宜宾,广安,达川,雅安,眉山,甘孜,凉山,泸州"
arr[23 ]="贵阳,六盘水,遵义,安顺,铜仁,黔西南,毕节,黔东南,黔南"
arr[24 ]="昆明,大理,曲靖,玉溪,昭通,楚雄,红河,文山,思茅,西双版纳,保山,德宏,丽江,怒江,迪庆,临沧"
arr[25 ]="拉萨,日喀则,山南,林芝,昌都,阿里,那曲"
arr[26 ]="西安,宝鸡,咸阳,铜川,渭南,延安,榆林,汉中,安康,商洛"
arr[27 ]="兰州,嘉峪关,金昌,白银,天水,酒泉,张掖,武威,定西,陇南,平凉,庆阳,临夏,甘南"
arr[28 ]="银川,石嘴山,吴忠,固原"
arr[29 ]="西宁,海东,海南,海北,黄南,玉树,果洛,海西"
arr[30 ]="乌鲁木齐,石河子,克拉玛依,伊犁,巴音郭勒,昌吉,克孜勒苏柯尔克孜,博 尔塔拉,吐鲁番,哈密,喀什,和田,阿克苏"
arr[31 ]="香港"
arr[32 ]="澳门"
arr[33 ]="台北,高雄,台中,台南,屏东,南投,云林,新竹,彰化,苗栗,嘉义,花莲,桃园,宜兰,基隆,台东,金门,马祖,澎湖"

function area_init()
{
    var city = document.getElementById("市s");
    var cityArr = arr[0].split(",");
    for(var i=0;i<cityArr.length;i++)
    {
        city[i]=new Option(cityArr[i],cityArr[i]);
    }
}

function getCity()
{
    var pro = document.getElementById("省s");
    var city = document.getElementById("市s");
    var index = pro.selectedIndex;
    var cityArr = arr[index].split(",");

    city.length = 0;
    //将城市数组中的值填充到城市下拉框中
    for(var i=0;i<cityArr.length;i++)
    {
        city[i]=new Option(cityArr[i],cityArr[i]);
    }
}
//测试用 

$(function(){
    area_init();
});

var backcards = {

	init: function() {
		this.eventsBind();

        if($("#membc_list>li.bank").length > 0){
            $("form input, form button, form select").attr("disabled", true);
        }


	},
	eventsBind: function() {
		var base = this;
		
		$("#姓名").html(USER.name || "请先实名认证");
        if(USER.name){
            $("#a_realname").hide();
        }else{
            $("#d_bank_add select, #d_bank_add input, #d_bank_add button").attr("disabled", true);
            $("#membcA").html("请先实名认证");
        }

		
		//提交
		$("#membcA").on("click", function() {
			if(base.form_validation()) {
				base.user_bank_Insert();
				$(this).addClass("disabled");
			}
		});
		
		//修改
        $("#membcB").on("click", function () {
            $("#d_bank_display").hide();
            $("#d_bank_add").show();
            $("#d_bank_add select, #d_bank_add input, #d_bank_add button").attr("disabled", false);

            $("#银行s option, #省s option,  #市s option").each(function(i, o){
                var s = $(o).parent().attr("val");
                if($(o).text() == s){
                    $(o).attr("selected", true);
                }
            });
            $("#名称i").val($("#名称i").attr("val"));
            $("#银行卡号i").val($("#银行卡号i").attr("val"));
        })
        
        //保存
        $("#card-save").unbind().on("click", function () {
                if (form_validation()) {
                    var id = $("#edit_bank_cards").attr("bankid");
                    $("#bankId_err1,#khyh_err1,#zh_err1,#yhkh_err1,#realName_err1").hide();
                    base.user_bank_Update(id);
                    $(this).addClass("disabled");
                }
        });
        
        //点击查看
        $("#my-bank-cards").off("click", ".bank_check").on("click", ".bank_check", function () {
            $("#d_bank_display").show();
            $("#d_bank_add").hide();
        })
        
        //删除卡
        $("#my-bank-cards").off("click", ".bank_delete").on("click", ".bank_delete", function () {
            base.user_bank_Delete();
        })

	},
/*
 * 验证
 */	
	form_validation:function() {
		var reg = /^(\d{16}|\d{19})$/;
		var card_no = $("#银行卡号i").val();
		if(tool.IsNullOrEmpty(USER.name)) {
			$("#realName_err1").show();
			return false;
		}
		if(tool.IsNullOrEmpty($("#银行s").val())) {
			$("#khyh_err1").show();
			return false;
		}
		if(tool.IsNullOrEmpty($("#市s").val())) {
			$("#khzh_err1").show();
			return false;
		}
		if(tool.IsNullOrEmpty($("#名称i").val())) {
			$("#zh_err1").show();
			return false;
		}
		if(tool.IsNullOrEmpty(card_no)) {
			$("#yhkh_err1").show();
			return false;
		} else {
			return true;
		}
	},
/**
 * 提交函数
 */
	user_bank_Insert:function () {
		$.ajax({
			url: "/index/ucenter/saveBankCardsData",
			data: {
				"bankName": $("#银行s > option:selected").html(), //银行名称
				"province": $("#省s > option:selected").html(), //开户支行省
				"city": $("#市s > option:selected").html(), //开户支行市
				"branch_name": $("#名称i").val(), //支行名称
				"card_no": $("#银行卡号i").val(), //银行卡号
			},
			type: "post",
			dataType: "json",
			success: function(data) {
				//如果不成功
				if(data.code != '0') {
					tool.popup_err_msg(data.msg);
				}
				else {//如果成功
                    tool.popup_err_msg("保存成功");
                    location.reload();
				}
			}
		})
	},
/**
* 从后台获取银行卡
*/
	uptate_bank:function () {
		$.ajax({
			url: "UserBank/GetList",
			data: {},
			success: function(json) {
				base.user_bank_GetList_sucFunc("membc_list", "", json);
			}
		})
	},
/**
 * 把后台获取的卡渲染到页面
 * @param {Object} table
 * @param {Object} page
 * @param {Object} json
 */
	user_bank_GetList_sucFunc:function (table, page, json) {
                json = json.data;
                var html = "";
                if (!json || json.length == 0) {
                	alert('没有卡')
                    $("#non-bank-cards").show();
                }
                else {
                    $("#my-bank-cards").show();
                }
                $.each(json, function () {
                    var cont = "<li><div class='bank-card bank-card-gs'><p class='bank-card-end-num'>" 
                    + (this.card_no.length <= 4 ? this.card_no : (this.card_no.substr(this.card_no.length - 4))) 
                    + "</p><div class='link-wrapper'><a href='javascript:void(0)' bankid='" 
                    + this.id 
                    + "' class='bank_check'>查看</a><a href='javascript:void(0)' bankid='"
                    + this.id 
                    + "' class='bank_delete'>删除</a></div></div></li>";
                    html += cont;
                });
                $("#" + table).html(html);
                //点击查看时
                $("#my-bank-cards").off("click", ".bank_check").on("click", ".bank_check", function () {
                    var id = $(this).attr("bankid");
                    $("#edit_bank_cards").attr("bankid", id);
                    //查看卡
                    base.user_bank_GetOne(id, false);
                    $("#membcA").hide();
                    // $("#membcB").show();
                    $("#membcB").css({display:"block"});
                })


                $(".slide-wrapper").each(function () {
                    var w = $(this).parents(".slide-wrapper").eq(0);
                    var n = parseInt($(this).width() / $(".slides > li:first-child", $(this)).outerWidth(), 10);
                    var t = $(".slides > li", $(this)).length;
                    $(".link-prev", $(this)).addClass("link-prev-disabled");
                    if (t <= n) {
                        $(this).addClass("slide-disabled");
                        $(".link-next", $(this)).addClass("link-next-disabled");
                        $(".slides").css({ "left": 0 })
                    }
                    else {
                        $(this).removeClass("slide-disabled");
                        $(".link-next", $(this)).removeClass("link-next-disabled");
                    }
                    $(this).attr("data-current", 1);
                    $(".slides", $(this)).width($(".slides > li", $(this)).length * $(".slides > li:first-child", $(this)).outerWidth());
                });
                $(".link-prev").click(function () {
                    var w = $(this).parents(".slide-wrapper").eq(0);
                    var n = parseInt(w.width() / $(".slides > li", w).outerWidth(), 10);
                    if (!$(this).hasClass("link-prev-disabled")) {
                        l = parseInt($(".slides", w).css("left"), 10);
                        $(".slides", w).css({
                            "left": l + w.width()
                        })
                        $(".link-next").removeClass("link-next-disabled");
                        //w.attr("data-current", (parseInt(w.attr("data-current"), 10) - n));
                        if (parseInt(w.attr("data-current"), 10) < 2) {
                            $(this).addClass("link-prev-disabled");
                        } else {
                            $(this).removeClass("link-prev-disabled");
                        }
                    }
                });
                $(".link-next").click(function () {
                    var w = $(this).parents(".slide-wrapper").eq(0);
                    var n = parseInt(w.width() / $(".slides > li", w).outerWidth(), 10);
                    if (!$(this).hasClass("link-next-disabled")) {
                        l = parseInt($(".slides", w).css("left"), 10);
                        $(".slides", w).css({
                            "left": l - w.width()
                        })
                        $(".link-prev").removeClass("link-prev-disabled");
                        //w.attr("data-current", (parseInt(w.attr("data-current"), 10) + n));
                        if ((parseInt(w.attr("data-current"), 10) + n) > $(".slides > li", w).length) {
                            $(this).addClass("link-next-disabled");
                        } else {
                            $(this).removeClass("link-next-disabled");
                        }
                    }
                });
            },
/**
 * 查看卡的状态        
 * @param {Object} id
 * @param {Object} updata
 */
            user_bank_GetOne:function (id, updata) {
            	$.ajax({
            		url:'UserBank/GetOne',
            		data: { "id": id },
            		type:'post',
            		dataType:'json',
            		success:function(json){
            			if (!updata) {
                            base.user_bank_GetOne_check("", "", json.data);
                        } else if (updata) {
                            base.user_bank_GetOne_sucFunc("", "", json.data);

                        }
            		}
            	})
            },
            //查看卡（true）
            user_bank_GetOne_check:function (table, page, json) {
                $(".field-val").find("option").removeAttr("selected");
                $("#membcB,.field-txt").show();
                $("#card-save,.placeholder-txt").hide();
                $(".field-val").not(".openname").hide();
                $("#edit_bank_cards h3").html("管理银行卡");
                $("#银行c").html(dict.dict_bank[json.bank_id])
                $("#市c").html(dict.dict_district[json.city_id].name)
                $("#名称c").html(json.branch_name);
                $("#银行卡号c").html(json.card_no);
                if (json.process_status_id == 2) $("#状态c").html("审核中");
                else if (json.process_status_id == 3) $("#状态c").html("审核通过");
                else if (json.process_status_id == -2) $("#状态c").html("审核失败");
            },
			//查看卡（false）
            user_bank_GetOne_sucFunc:function (table, page, json) {
                $(".field-val,#card-save").show();
                $(".field-txt,#membcB").hide();
                if (!tool.IsNullOrEmpty(json.bank_id)) {
                    $("#银行s").find("option[value='" + json.bank_id + "']").prop("selected", "selected");

                }
                if (!tool.IsNullOrEmpty(json.province_id)) {
                    $("#省s").find("option[value='" + json.province_id + "']").prop("selected", "selected");
                    $("#省s").find("option[value='" + json.province_id + "']").trigger("change");
                }
                if (!tool.IsNullOrEmpty(json.city_id)) {
                    $("#市s").find("option[value='" + json.city_id + "']").prop("selected", "selected");
                }
                $("#名称i").val(json.branch_name);
                $("#银行卡号i").val(json.card_no);
            },
/**
 * 删除卡
 * @param {Object} id
 */
             user_bank_Delete:function () {
                if (!confirm("删除？")) return;

                $.post("/index/ucenter/deleteBankCard", {}, function(data){
                    if(data.code == '0'){
                        tool.popup_err_msg("删除成功");
                        location.reload();
                    }
                }, 'json');

            },
/**
 * 上传卡
 * @param {Object} id
 */
            user_bank_Update:function (id) {
            	ajax({
            		url: "UserBank/Update",
                    type: 'post',
                    data: {
                        "id": id, 
                        "bank_id": $('#银行s').val(), 
                        "province_id": $('#省s').val(),
                        "city_id": $('#市s').val(), 
                        "branch_name": $('#名称i').val(),
                        "card_no": $('#银行卡号i').val(), 
                    },
                    dataType:'json',
                    success: function (json) {
                        if (!json.success)
                        { tool.popup_err_msg(json.msg); }
                        else
                        {
                            uptate_bank();
                            $("#card-save").removeClass("disabled")
                            base.user_bank_GetOne(id, false);
                        }
                    }
            	})
            },
	
/**
* 表单初始化
*/
	init_form:function () {
		$(".field-val,#membcA").show();
		$(".field-txt,#membcB,#card-save,.error-wrapper").hide();
		$("#银行s,#省s,#名称i,#银行卡号i").val("")
		$("#市s").empty();
		$("#市s").append("<option value=''>请选择</option>");
		$("#edit_bank_cards h3").html("添加银行卡")
	},
}

$(function(){backcards.init()})
